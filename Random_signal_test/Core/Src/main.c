/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * <h2><center>&copy; Copyright (c) 2021 STMicroelectronics.
  * All rights reserved.</center></h2>
  *
  * This software component is licensed by ST under BSD 3-Clause license,
  * the "License"; You may not use this file except in compliance with the
  * License. You may obtain a copy of the License at:
  *                        opensource.org/licenses/BSD-3-Clause
  *
  *
  * This program allows to change the signal values on the run.
  * By default the program give a rising sine signal.
  * The changes if required are mentioned in comments.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */
#include "math.h"
#include "stdlib.h"
/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */
/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */
#define RAND_MAX = 4095;
/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/

DAC_HandleTypeDef hdac1;

TIM_HandleTypeDef htim6;

/* USER CODE BEGIN PV */
uint32_t values[2048];
uint32_t sinev1[]={2048,2060,2073,2085,2098,2110,2123,2135,2148,2161,2173,2186,2198,2211,2223,2236,2248,2261,2273,2286,2298,2311,2323,2335,2348,2360,2373,2385,2398,2410,2422,2435,2447,2459,2472,2484,2496,2508,2521,2533,2545,2557,2569,2581,2594,2606,2618,2630,2642,2654,2666,2678,2690,2702,2714,2725,2737,2749,2761,2773,2784,2796,2808,2819,2831,2843,2854,2866,2877,2889,2900,2912,2923,2934,2946,2957,2968,2979,2990,3002,3013,3024,3035,3046,3057,3068,3078,3089,3100,3111,3122,3132,3143,3154,3164,3175,3185,3195,3206,3216,3226,3237,3247,3257,3267,3277,3287,3297,3307,3317,3327,3337,3346,3356,3366,3375,3385,3394,3404,3413,3423,3432,3441,3450,3459,3468,3477,3486,3495,3504,3513,3522,3530,3539,3548,3556,3565,3573,3581,3590,3598,3606,3614,3622,3630,3638,3646,3654,3662,3669,3677,3685,3692,3700,3707,3714,3722,3729,3736,3743,3750,3757,3764,3771,3777,3784,3791,3797,3804,3810,3816,3823,3829,3835,3841,3847,3853,3859,3865,3871,3876,3882,3888,3893,3898,3904,3909,3914,3919,3924,3929,3934,3939,3944,3949,3953,3958,3962,3967,3971,3975,3980,3984,3988,3992,3996,3999,4003,4007,4010,4014,4017,4021,4024,4027,4031,4034,4037,4040,4042,4045,4048,4051,4053,4056,4058,4060,4063,4065,4067,4069,4071,4073,4075,4076,4078,4080,4081,4083,4084,4085,4086,4087,4088,4089,4090,4091,4092,4093,4093,4094,4094,4094,4095,4095,4095,4095,4095,4095,4095,4094,4094,4094,4093,4093,4092,4091,4090,4089,4088,4087,4086,4085,4084,4083,4081,4080,4078,4076,4075,4073,4071,4069,4067,4065,4063,4060,4058,4056,4053,4051,4048,4045,4042,4040,4037,4034,4031,4027,4024,4021,4017,4014,4010,4007,4003,3999,3996,3992,3988,3984,3980,3975,3971,3967,3962,3958,3953,3949,3944,3939,3934,3929,3924,3919,3914,3909,3904,3898,3893,3888,3882,3876,3871,3865,3859,3853,3847,3841,3835,3829,3823,3816,3810,3804,3797,3791,3784,3777,3771,3764,3757,3750,3743,3736,3729,3722,3714,3707,3700,3692,3685,3677,3669,3662,3654,3646,3638,3630,3622,3614,3606,3598,3590,3581,3573,3565,3556,3548,3539,3530,3522,3513,3504,3495,3486,3477,3468,3459,3450,3441,3432,3423,3413,3404,3394,3385,3375,3366,3356,3346,3337,3327,3317,3307,3297,3287,3277,3267,3257,3247,3237,3226,3216,3206,3195,3185,3175,3164,3154,3143,3132,3122,3111,3100,3089,3078,3068,3057,3046,3035,3024,3013,3002,2990,2979,2968,2957,2946,2934,2923,2912,2900,2889,2877,2866,2854,2843,2831,2819,2808,2796,2784,2773,2761,2749,2737,2725,2714,2702,2690,2678,2666,2654,2642,2630,2618,2606,2594,2581,2569,2557,2545,2533,2521,2508,2496,2484,2472,2459,2447,2435,2422,2410,2398,2385,2373,2360,2348,2335,2323,2311,2298,2286,2273,2261,2248,2236,2223,2211,2198,2186,2173,2161,2148,2135,2123,2110,2098,2085,2073,2060,2048,2035,2022,2010,1997,1985,1972,1960,1947,1934,1922,1909,1897,1884,1872,1859,1847,1834,1822,1809,1797,1784,1772,1760,1747,1735,1722,1710,1697,1685,1673,1660,1648,1636,1623,1611,1599,1587,1574,1562,1550,1538,1526,1514,1501,1489,1477,1465,1453,1441,1429,1417,1405,1393,1381,1370,1358,1346,1334,1322,1311,1299,1287,1276,1264,1252,1241,1229,1218,1206,1195,1183,1172,1161,1149,1138,1127,1116,1105,1093,1082,1071,1060,1049,1038,1027,1017,1006,995,984,973,963,952,941,931,920,910,900,889,879,869,858,848,838,828,818,808,798,788,778,768,758,749,739,729,720,710,701,691,682,672,663,654,645,636,627,618,609,600,591,582,573,565,556,547,539,530,522,514,505,497,489,481,473,465,457,449,441,433,426,418,410,403,395,388,381,373,366,359,352,345,338,331,324,318,311,304,298,291,285,279,272,266,260,254,248,242,236,230,224,219,213,207,202,197,191,186,181,176,171,166,161,156,151,146,142,137,133,128,124,120,115,111,107,103,99,96,92,88,85,81,78,74,71,68,64,61,58,55,53,50,47,44,42,39,37,35,32,30,28,26,24,22,20,19,17,15,14,12,11,10,9,8,7,6,5,4,3,2,2,1,1,1,0,0,0,0,0,0,0,1,1,1,2,2,3,4,5,6,7,8,9,10,11,12,14,15,17,19,20,22,24,26,28,30,32,35,37,39,42,44,47,50,53,55,58,61,64,68,71,74,78,81,85,88,92,96,99,103,107,111,115,120,124,128,133,137,142,146,151,156,161,166,171,176,181,186,191,197,202,207,213,219,224,230,236,242,248,254,260,266,272,279,285,291,298,304,311,318,324,331,338,345,352,359,366,373,381,388,395,403,410,418,426,433,441,449,457,465,473,481,489,497,505,514,522,530,539,547,556,565,573,582,591,600,609,618,627,636,645,654,663,672,682,691,701,710,720,729,739,749,758,768,778,788,798,808,818,828,838,848,858,869,879,889,900,910,920,931,941,952,963,973,984,995,1006,1017,1027,1038,1049,1060,1071,1082,1093,1105,1116,1127,1138,1149,1161,1172,1183,1195,1206,1218,1229,1241,1252,1264,1276,1287,1299,1311,1322,1334,1346,1358,1370,1381,1393,1405,1417,1429,1441,1453,1465,1477,1489,1501,1514,1526,1538,1550,1562,1574,1587,1599,1611,1623,1636,1648,1660,1673,1685,1697,1710,1722,1735,1747,1760,1772,1784,1797,1809,1822,1834,1847,1859,1872,1884,1897,1909,1922,1934,1947,1960,1972,1985,1997,2010,2022,2035,};


uint32_t sinev2[]={1024,1030,1037,1043,1049,1055,1062,1068,1074,1081,1087,1093,1099,1106,1112,1118,1124,1131,1137,1143,1149,1156,1162,1168,1174,1180,1187,1193,1199,1205,1211,1218,1224,1230,1236,1242,1248,1254,1261,1267,1273,1279,1285,1291,1297,1303,1309,1315,1321,1327,1333,1339,1345,1351,1357,1363,1369,1375,1381,1387,1393,1398,1404,1410,1416,1422,1427,1433,1439,1445,1450,1456,1462,1467,1473,1479,1484,1490,1496,1501,1507,1512,1518,1523,1529,1534,1540,1545,1550,1556,1561,1567,1572,1577,1582,1588,1593,1598,1603,1608,1614,1619,1624,1629,1634,1639,1644,1649,1654,1659,1664,1669,1674,1678,1683,1688,1693,1698,1702,1707,1712,1716,1721,1726,1730,1735,1739,1744,1748,1753,1757,1761,1766,1770,1774,1779,1783,1787,1791,1795,1799,1803,1808,1812,1816,1820,1823,1827,1831,1835,1839,1843,1846,1850,1854,1858,1861,1865,1868,1872,1875,1879,1882,1886,1889,1892,1896,1899,1902,1906,1909,1912,1915,1918,1921,1924,1927,1930,1933,1936,1939,1941,1944,1947,1950,1952,1955,1958,1960,1963,1965,1968,1970,1972,1975,1977,1979,1982,1984,1986,1988,1990,1992,1994,1996,1998,2000,2002,2004,2006,2007,2009,2011,2013,2014,2016,2017,2019,2020,2022,2023,2024,2026,2027,2028,2030,2031,2032,2033,2034,2035,2036,2037,2038,2039,2040,2040,2041,2042,2042,2043,2044,2044,2045,2045,2046,2046,2046,2047,2047,2047,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2048,2047,2047,2047,2046,2046,2046,2045,2045,2044,2044,2043,2042,2042,2041,2040,2040,2039,2038,2037,2036,2035,2034,2033,2032,2031,2030,2028,2027,2026,2024,2023,2022,2020,2019,2017,2016,2014,2013,2011,2009,2007,2006,2004,2002,2000,1998,1996,1994,1992,1990,1988,1986,1984,1982,1979,1977,1975,1972,1970,1968,1965,1963,1960,1958,1955,1952,1950,1947,1944,1941,1939,1936,1933,1930,1927,1924,1921,1918,1915,1912,1909,1906,1902,1899,1896,1892,1889,1886,1882,1879,1875,1872,1868,1865,1861,1858,1854,1850,1846,1843,1839,1835,1831,1827,1823,1820,1816,1812,1808,1803,1799,1795,1791,1787,1783,1779,1774,1770,1766,1761,1757,1753,1748,1744,1739,1735,1730,1726,1721,1716,1712,1707,1702,1698,1693,1688,1683,1678,1674,1669,1664,1659,1654,1649,1644,1639,1634,1629,1624,1619,1614,1608,1603,1598,1593,1588,1582,1577,1572,1567,1561,1556,1550,1545,1540,1534,1529,1523,1518,1512,1507,1501,1496,1490,1484,1479,1473,1467,1462,1456,1450,1445,1439,1433,1427,1422,1416,1410,1404,1398,1393,1387,1381,1375,1369,1363,1357,1351,1345,1339,1333,1327,1321,1315,1309,1303,1297,1291,1285,1279,1273,1267,1261,1254,1248,1242,1236,1230,1224,1218,1211,1205,1199,1193,1187,1180,1174,1168,1162,1156,1149,1143,1137,1131,1124,1118,1112,1106,1099,1093,1087,1081,1074,1068,1062,1055,1049,1043,1037,1030,1024,1018,1011,1005,999,993,986,980,974,967,961,955,949,942,936,930,924,917,911,905,899,892,886,880,874,868,861,855,849,843,837,830,824,818,812,806,800,794,787,781,775,769,763,757,751,745,739,733,727,721,715,709,703,697,691,685,679,673,667,661,655,650,644,638,632,626,621,615,609,603,598,592,586,581,575,569,564,558,552,547,541,536,530,525,519,514,508,503,498,492,487,481,476,471,466,460,455,450,445,440,434,429,424,419,414,409,404,399,394,389,384,379,374,370,365,360,355,350,346,341,336,332,327,322,318,313,309,304,300,295,291,287,282,278,274,269,265,261,257,253,249,245,240,236,232,228,225,221,217,213,209,205,202,198,194,190,187,183,180,176,173,169,166,162,159,156,152,149,146,142,139,136,133,130,127,124,121,118,115,112,109,107,104,101,98,96,93,90,88,85,83,80,78,76,73,71,69,66,64,62,60,58,56,54,52,50,48,46,44,42,41,39,37,35,34,32,31,29,28,26,25,24,22,21,20,18,17,16,15,14,13,12,11,10,9,8,8,7,6,6,5,4,4,3,3,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,2,3,3,4,4,5,6,6,7,8,8,9,10,11,12,13,14,15,16,17,18,20,21,22,24,25,26,28,29,31,32,34,35,37,39,41,42,44,46,48,50,52,54,56,58,60,62,64,66,69,71,73,76,78,80,83,85,88,90,93,96,98,101,104,107,109,112,115,118,121,124,127,130,133,136,139,142,146,149,152,156,159,162,166,169,173,176,180,183,187,190,194,198,202,205,209,213,217,221,225,228,232,236,240,245,249,253,257,261,265,269,274,278,282,287,291,295,300,304,309,313,318,322,327,332,336,341,346,350,355,360,365,370,374,379,384,389,394,399,404,409,414,419,424,429,434,440,445,450,455,460,466,471,476,481,487,492,498,503,508,514,519,525,530,536,541,547,552,558,564,569,575,581,586,592,598,603,609,615,621,626,632,638,644,650,655,661,667,673,679,685,691,697,703,709,715,721,727,733,739,745,751,757,763,769,775,781,787,794,800,806,812,818,824,830,837,843,849,855,861,868,874,880,886,892,899,905,911,917,924,930,936,942,949,955,961,967,974,980,986,993,999,1005,1011,1018};
uint32_t i=0,j=0;
/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
static void MX_GPIO_Init(void);
static void MX_DAC1_Init(void);
static void MX_TIM6_Init(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
	HAL_DAC_Start(&hdac1, DAC_CHANNEL_1);
	values[i]=rand();
	//Uncomment this section to use values from the look up table
	//values[i]=sinev[i];

	// To create random values change sinev1[] to values[]
	if(i<1024)
	{
	HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, sinev1[i]);
	i++;
	}

	if(i>=1023)
	{i=1023;
	HAL_DAC_SetValue(&hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, sinev2[j]);
	j++;
	}

	if(j>=1023)
		{j=0;
		i=0;
		}

}

/* USER CODE END 0 */

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_DAC1_Init();
  MX_TIM6_Init();
  /* USER CODE BEGIN 2 */
  HAL_TIM_Base_Start_IT(&htim6);
  /* USER CODE END 2 */

  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Supply configuration update enable
  */
  HAL_PWREx_ConfigSupply(PWR_LDO_SUPPLY);
  /** Configure the main internal regulator output voltage
  */
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE1);

  while(!__HAL_PWR_GET_FLAG(PWR_FLAG_VOSRDY)) {}
  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_DIV1;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_ON;
  RCC_OscInitStruct.PLL.PLLSource = RCC_PLLSOURCE_HSI;
  RCC_OscInitStruct.PLL.PLLM = 4;
  RCC_OscInitStruct.PLL.PLLN = 12;
  RCC_OscInitStruct.PLL.PLLP = 2;
  RCC_OscInitStruct.PLL.PLLQ = 4;
  RCC_OscInitStruct.PLL.PLLR = 2;
  RCC_OscInitStruct.PLL.PLLRGE = RCC_PLL1VCIRANGE_3;
  RCC_OscInitStruct.PLL.PLLVCOSEL = RCC_PLL1VCOWIDE;
  RCC_OscInitStruct.PLL.PLLFRACN = 4096;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }
  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2
                              |RCC_CLOCKTYPE_D3PCLK1|RCC_CLOCKTYPE_D1PCLK1;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_PLLCLK;
  RCC_ClkInitStruct.SYSCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB3CLKDivider = RCC_APB3_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_APB1_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_APB2_DIV1;
  RCC_ClkInitStruct.APB4CLKDivider = RCC_APB4_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_1) != HAL_OK)
  {
    Error_Handler();
  }
}

/**
  * @brief DAC1 Initialization Function
  * @param None
  * @retval None
  */
static void MX_DAC1_Init(void)
{

  /* USER CODE BEGIN DAC1_Init 0 */

  /* USER CODE END DAC1_Init 0 */

  DAC_ChannelConfTypeDef sConfig = {0};

  /* USER CODE BEGIN DAC1_Init 1 */

  /* USER CODE END DAC1_Init 1 */
  /** DAC Initialization
  */
  hdac1.Instance = DAC1;
  if (HAL_DAC_Init(&hdac1) != HAL_OK)
  {
    Error_Handler();
  }
  /** DAC channel OUT1 config
  */
  sConfig.DAC_SampleAndHold = DAC_SAMPLEANDHOLD_DISABLE;
  sConfig.DAC_Trigger = DAC_TRIGGER_T6_TRGO;
  sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;
  sConfig.DAC_ConnectOnChipPeripheral = DAC_CHIPCONNECT_DISABLE;
  sConfig.DAC_UserTrimming = DAC_TRIMMING_FACTORY;
  if (HAL_DAC_ConfigChannel(&hdac1, &sConfig, DAC_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN DAC1_Init 2 */

  /* USER CODE END DAC1_Init 2 */

}

/**
  * @brief TIM6 Initialization Function
  * @param None
  * @retval None
  */
static void MX_TIM6_Init(void)
{

  /* USER CODE BEGIN TIM6_Init 0 */

  /* USER CODE END TIM6_Init 0 */

  TIM_MasterConfigTypeDef sMasterConfig = {0};

  /* USER CODE BEGIN TIM6_Init 1 */

  /* USER CODE END TIM6_Init 1 */
  htim6.Instance = TIM6;
  htim6.Init.Prescaler = 0;
  htim6.Init.CounterMode = TIM_COUNTERMODE_UP;
  htim6.Init.Period = 65535;
  htim6.Init.AutoReloadPreload = TIM_AUTORELOAD_PRELOAD_DISABLE;
  if (HAL_TIM_Base_Init(&htim6) != HAL_OK)
  {
    Error_Handler();
  }
  sMasterConfig.MasterOutputTrigger = TIM_TRGO_UPDATE;
  sMasterConfig.MasterSlaveMode = TIM_MASTERSLAVEMODE_DISABLE;
  if (HAL_TIMEx_MasterConfigSynchronization(&htim6, &sMasterConfig) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN TIM6_Init 2 */

  /* USER CODE END TIM6_Init 2 */

}

/**
  * @brief GPIO Initialization Function
  * @param None
  * @retval None
  */
static void MX_GPIO_Init(void)
{

  /* GPIO Ports Clock Enable */
  __HAL_RCC_GPIOA_CLK_ENABLE();

}

/* USER CODE BEGIN 4 */

/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */

/************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
